<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 fw-bold">Listado de Devoluciones</h1>
    <%= link_to new_admin_devolucione_path, class: "btn btn-primary shadow-sm", data: { turbo: false } do %>
      <i class="fas fa-plus-circle me-2"></i> Nueva DevoluciÃ³n
    <% end %>
  </div>
      <%# TOAST DE DEVOLUCIONES PENDIENTES %>
  <% if @pending_devoluciones_count.to_i > 0 %>
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1100;">
      <div id="pendingDevolucionesToast"
           class="toast align-items-center text-bg-warning border-0 shadow"
           role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body">
            ðŸ”” Hay <%= @pending_devoluciones_count %> devoluciones pendientes de autorizar.
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto"
                  data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>
    </div>

    <%= javascript_tag do %>
      document.addEventListener("DOMContentLoaded", function() {
        var toastEl = document.getElementById("pendingDevolucionesToast");
        if (toastEl) {
          var toast = new bootstrap.Toast(toastEl, { delay: 5000 });
          toast.show();
        }
      });
    <% end %>
  <% end %>





  <% if @devoluciones.any? %>
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle shadow-sm rounded">
        <thead class="table-dark text-center">
          <tr>
            <th>Cliente</th>
            <th>Fecha de DevoluciÃ³n</th>
            <th>Comentarios</th>
            <th>Caja</th>
            <th>Cajero</th>
            <th>Venta Asociada</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <% @devoluciones.each do |devolucion| %>
            <tr>
              <td><%= devolucion.client_name.presence || "â€”" %></td>
              <td class="text-center"><%= devolucion.fecha_devolucion&.strftime("%d/%m/%Y %H:%M") || "â€”" %></td>
              <td class="text-muted"><%= devolucion.comments_devolucion.presence || "Sin comentarios" %></td>
              <td class="text-center"><%= devolucion.caja&.nombre || "â€”" %></td>
              <td class="text-center"><%= devolucion.cajero&.nombre || "â€”" %></td>
              <td class="text-center"><%= devolucion.sale&.code || "â€”" %></td>
              <td class="text-center">
                <div class="d-flex justify-content-center gap-2">
                  <!-- Editar -->
                  <%= link_to edit_admin_devolucione_path(devolucion), class: "btn btn-outline-warning btn-sm", title: "Editar", data: { bs_toggle: "tooltip", bs_placement: "top" } do %>
                    <i class="fas fa-edit"></i>
                  <% end %>

                  <!-- Eliminar -->
                  <%= button_to admin_devolucione_path(devolucion),
                        method: :delete,
                        form: { class: "d-inline" },
                        data: { turbo_confirm: "Â¿Seguro que deseas eliminar esta devoluciÃ³n?", bs_toggle: "tooltip", bs_placement: "top" },
                        class: "btn btn-outline-danger btn-sm" do %>
                    <i class="fas fa-trash-alt"></i>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="alert alert-info text-center shadow-sm">
      No hay devoluciones registradas.
    </div>
  <% end %>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(el => new bootstrap.Tooltip(el));
  });
</script>
