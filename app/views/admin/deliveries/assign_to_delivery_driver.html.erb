<div class="container py-5 bg-light min-vh-100">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
      <div>
        <h3 class="h3 mb-0 text-gray-800">Admin / Asignar mensajero a pedido</h3></div>

        <div><%= link_to admin_pedidos_path, class: "d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" do %>
            <i class="fas fa-arrow-left fa-sm text-white-50"></i> Volver a pedidos
            <% end %></div>
    </div>
      
    <div class="card shadow-sm border-0 rounded-4 p-4 mb-4">

        <%= form_with url: admin_assign_to_delivery_driver_path(@sale), method: :patch, scope: :delivery do |f| %>

        <h5>Lista de mensajeros sin pedidos en ruta</h5>
        <!-- Fecha -->


        <!-- Hora (select quemado) -->
        <div class="mb-3">
            <%= f.label :delivery_driver_id, "Seleccionar mensajero", class: "form-label fw-bold" %>
            <%= f.select :delivery_driver_id,
                    @available_drivers.map { |d| [d.nombre, d.id.to_s] },
                    { include_blank: "Seleccione un mensajero" },
                    class: "form-select" %>
        </div>

        <%= f.hidden_field :delivery_id, value: @delivery.id %>
        
        <div class="row">
            <div class="col-6">
                <%= f.submit "Asignar mensajero", class: "btn btn-primary" %>
            </div>
        </div>

        <% end %>
    </div>

    <div class="card mb-4 shadow-sm border-0 rounded-4 p-3">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div>
            <strong class="fs-6">Código: <%= @delivery.sale.code %></strong><br>
            <small class="text-muted">Realizada el <%= l(@delivery.sale.sold_at, format: :long) %></small>
          </div>
        </div>

        <% @delivery.sale.product_sales.each do |ps| %>
          <div class="d-flex align-items-center border-top pt-3 mt-2">
            <!-- Imagen del producto -->
            <% if ps.product && ps.product.product_images.any? %>
              <%= image_tag ps.product.product_images.first.image_url, 
                    class: "rounded me-4", 
                    style: "width: 100px; height: 100px; object-fit: cover;" %>
            <% else %>
              <%= image_tag "placeholder.png", class: "rounded me-4", style: "width: 100px; height: 100px; object-fit: cover;" %>
            <% end %>

            <!-- Detalles del producto -->
            <div class="flex-grow-1">
              <strong><%= ps.product&.name %></strong><br>
              <span class="text-muted">Cantidad:</span> <%= ps.quantity %><br>
              <span class="text-success fw-bold">$<%= '%.2f' % ps.subtotal %></span>
            </div>
          </div>
        <% end %>

        <div class="mt-3">
          <p class="mb-1">
            <strong>Método de envío:</strong>
            <%= @delivery.sale&.delivery_method.present? ? @delivery.sale.delivery_method.titleize : "Recoger en tienda" %>
          </p>
          <% if @delivery.sale.delivery_method == "delivery"%>
            <% if @delivery.sale.was_delivered == false %>
              <span class="badge badge-warning">No entregado</span>
              <% if @delivery.sale.delivery.present? %>
                <span class="badge badge-info"><%= @delivery.sale.delivery.package_status %></span>
              <% else %>
                <span class="badge badge-secondary">Proceso de entrega no iniciado</span>
              <% end %>
            <% else %>
              <span></span>
            <% end %>
          <% end %>
          <p class="mb-1 text-muted"><small>El pago se realizará al recoger el producto.</small></p>
        </div>

        <div class="d-flex justify-content-between align-items-center border-top mt-3 pt-3">
          <span class="fw-bold fs-5 text-success">Total: $<%= '%.2f' % @delivery.sale.total_amount %></span>
        </div>
      </div>

</div>

<script>

</script>
